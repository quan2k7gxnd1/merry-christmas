<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>NOEL 3D</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { margin:0; overflow:hidden; background:#000; font-family: 'Times New Roman', serif; }
#canvas-container { width:100vw; height:100vh; position:absolute; inset:0; }

#ui-layer{
    position:absolute; inset:0; z-index:10;
    display:flex; flex-direction:column;
    align-items:center; padding-top:40px;
    pointer-events:none;
}
h1{
    font-size:52px; letter-spacing:6px;
    background:linear-gradient(#fff,#eebb66);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    text-shadow:0 0 40px rgba(255,220,150,.6);
}
.hint{
    margin-top:10px;
    font-size:10px;
    color:rgba(255,215,150,.6);
    letter-spacing:2px;
}
</style>

<script type="importmap">
{
 "imports":{
  "three":"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
  "three/addons/":"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
  "@mediapipe/tasks-vision":"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/+esm"
 }
}
</script>
</head>

<body>

<div id="canvas-container"></div>

<div id="ui-layer">
    <h1>MERRY CHRISTMAS</h1>
    <div class="hint">M: Nhạc • Xòe tay / nắm tay / chụm tay để điều khiển</div>
</div>

<script type="module">
import * as THREE from 'three';
import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
import { FilesetResolver, HandLandmarker } from '@mediapipe/tasks-vision';

/* ================= CONFIG ================= */
const PHOTO_URLS = [
 "https://i.ibb.co/0P4ZLkM/588762790-824023220477218-4317473318169109565-n.jpg",
 "https://i.ibb.co/d4mc2hxy/588902190-1573419777347798-2177944293432622076-n.jpg",
 "https://i.ibb.co/HpVSz7nf/BAC-0289.jpg"
 "https://i.ibb.co/rT4qRmx/BAC-1678-Copy.jpg"
 "https://i.ibb.co/ynFdbkmr/DSC06577.jpg"
 "https://i.ibb.co/rR6m3cqj/HPN00765.jpg"
 "https://i.ibb.co/Z6j2n4rt/HPN01709.jpg"
];

let scene, camera, renderer, composer, group;
let clock = new THREE.Clock();
let particles = [];
let photoGroup = new THREE.Group();

/* ================= MUSIC ================= */
let music = new Audio("music.mp3");
music.loop = true;
music.volume = 0.4;
let musicOn = true;

window.addEventListener("click",()=>{
    if(musicOn && music.paused) music.play();
},{once:true});

window.addEventListener("keydown",e=>{
    if(e.key.toLowerCase()==="m"){
        musicOn = !musicOn;
        musicOn ? music.play() : music.pause();
    }
});

/* ================= INIT ================= */
init();
function init(){
    scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x000000,0.015);

    camera = new THREE.PerspectiveCamera(42,innerWidth/innerHeight,0.1,1000);
    camera.position.z = 50;

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(innerWidth,innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio,2));
    document.getElementById("canvas-container").appendChild(renderer.domElement);

    composer = new EffectComposer(renderer);
    composer.addPass(new RenderPass(scene,camera));
    composer.addPass(new UnrealBloomPass(
        new THREE.Vector2(innerWidth,innerHeight),0.6,0.4,0.8
    ));

    group = new THREE.Group();
    scene.add(group);

    scene.add(new THREE.AmbientLight(0xffffff,0.6));
    const light = new THREE.PointLight(0xffcc88,2,30);
    light.position.set(0,5,0);
    group.add(light);

    createTree();
    loadPhotos();
    animate();
}

/* ================= TREE ================= */
function createTree(){
    const geo = new THREE.SphereGeometry(0.5,24,24);
    const mat = new THREE.MeshStandardMaterial({
        color:0xffd966, metalness:1, roughness:.2
    });

    for(let i=0;i<1200;i++){
        const m = new THREE.Mesh(geo,mat);
        const t = Math.random();
        const y = t*24-12;
        const r = (1-t)*8;
        const a = t*40;
        m.position.set(Math.cos(a)*r,y,Math.sin(a)*r);
        const s = 0.3+Math.random()*0.4;
        m.scale.setScalar(s);
        group.add(m);
        particles.push(m);
    }

    group.add(photoGroup);
}

/* ================= PHOTOS ================= */
function addPhoto(tex){
    const frame = new THREE.Mesh(
        new THREE.BoxGeometry(1.4,1.4,.05),
        new THREE.MeshStandardMaterial({color:0xffd966,metalness:1})
    );
    const photo = new THREE.Mesh(
        new THREE.PlaneGeometry(1.2,1.2),
        new THREE.MeshBasicMaterial({map:tex})
    );
    photo.position.z = .04;
    const g = new THREE.Group();
    g.add(frame); g.add(photo);
    g.scale.setScalar(.8);
    photoGroup.add(g);
}

function loadPhotos(){
    const loader = new THREE.TextureLoader();
    PHOTO_URLS.forEach(url=>{
        loader.load(url,tex=>{
            tex.colorSpace = THREE.SRGBColorSpace;
            addPhoto(tex);
        });
    });
}

/* ================= ANIMATE ================= */
function animate(){
    requestAnimationFrame(animate);
    const dt = clock.getDelta();
    group.rotation.y += dt*0.3;
    composer.render();
}

window.addEventListener("resize",()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth,innerHeight);
    composer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
